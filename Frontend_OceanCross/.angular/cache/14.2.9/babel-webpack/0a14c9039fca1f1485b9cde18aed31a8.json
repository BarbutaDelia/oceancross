{"ast":null,"code":"const debug = require('debug')('log4js:tcp');\n\nconst net = require('net');\n\nfunction appender(config, layout) {\n  let canWrite = false;\n  const buffer = [];\n  let socket;\n  let shutdownAttempts = 3;\n  let endMsg = '__LOG4JS__';\n\n  function write(loggingEvent) {\n    debug('Writing log event to socket');\n    canWrite = socket.write(`${layout(loggingEvent)}${endMsg}`, 'utf8');\n  }\n\n  function emptyBuffer() {\n    let evt;\n    debug('emptying buffer');\n\n    while (evt = buffer.shift()) {\n      write(evt);\n    }\n  }\n\n  function createSocket() {\n    debug(`appender creating socket to ${config.host || 'localhost'}:${config.port || 5000}`);\n    endMsg = `${config.endMsg || '__LOG4JS__'}`;\n    socket = net.createConnection(config.port || 5000, config.host || 'localhost');\n    socket.on('connect', () => {\n      debug('socket connected');\n      emptyBuffer();\n      canWrite = true;\n    });\n    socket.on('drain', () => {\n      debug('drain event received, emptying buffer');\n      canWrite = true;\n      emptyBuffer();\n    });\n    socket.on('timeout', socket.end.bind(socket));\n    socket.on('error', e => {\n      debug('connection error', e);\n      canWrite = false;\n      emptyBuffer();\n    });\n    socket.on('close', createSocket);\n  }\n\n  createSocket();\n\n  function log(loggingEvent) {\n    if (canWrite) {\n      write(loggingEvent);\n    } else {\n      debug('buffering log event because it cannot write at the moment');\n      buffer.push(loggingEvent);\n    }\n  }\n\n  log.shutdown = function (cb) {\n    debug('shutdown called');\n\n    if (buffer.length && shutdownAttempts) {\n      debug('buffer has items, waiting 100ms to empty');\n      shutdownAttempts -= 1;\n      setTimeout(() => {\n        log.shutdown(cb);\n      }, 100);\n    } else {\n      socket.removeAllListeners('close');\n      socket.end(cb);\n    }\n  };\n\n  return log;\n}\n\nfunction configure(config, layouts) {\n  debug(`configure with config = ${config}`);\n\n  let layout = function (loggingEvent) {\n    return loggingEvent.serialise();\n  };\n\n  if (config.layout) {\n    layout = layouts.layout(config.layout.type, config.layout);\n  }\n\n  return appender(config, layout);\n}\n\nmodule.exports.configure = configure;","map":{"version":3,"names":["debug","require","net","appender","config","layout","canWrite","buffer","socket","shutdownAttempts","endMsg","write","loggingEvent","emptyBuffer","evt","shift","createSocket","host","port","createConnection","on","end","bind","e","log","push","shutdown","cb","length","setTimeout","removeAllListeners","configure","layouts","serialise","type","module","exports"],"sources":["/Users/deliabarbuta/Documents/An4Sem1/PAW/Proiect/proiect-paw-tadam/Frontend_OceanCross/node_modules/log4js/lib/appenders/tcp.js"],"sourcesContent":["const debug = require('debug')('log4js:tcp');\nconst net = require('net');\n\nfunction appender(config, layout) {\n  let canWrite = false;\n  const buffer = [];\n  let socket;\n  let shutdownAttempts = 3;\n  let endMsg = '__LOG4JS__';\n\n  function write(loggingEvent) {\n    debug('Writing log event to socket');\n    canWrite = socket.write(`${layout(loggingEvent)}${endMsg}`, 'utf8');\n  }\n\n  function emptyBuffer() {\n    let evt;\n    debug('emptying buffer');\n    while ((evt = buffer.shift())) {\n      write(evt);\n    }\n  }\n\n  function createSocket() {\n    debug(\n      `appender creating socket to ${config.host || 'localhost'}:${\n        config.port || 5000\n      }`\n    );\n    endMsg = `${config.endMsg || '__LOG4JS__'}`;\n    socket = net.createConnection(\n      config.port || 5000,\n      config.host || 'localhost'\n    );\n    socket.on('connect', () => {\n      debug('socket connected');\n      emptyBuffer();\n      canWrite = true;\n    });\n    socket.on('drain', () => {\n      debug('drain event received, emptying buffer');\n      canWrite = true;\n      emptyBuffer();\n    });\n    socket.on('timeout', socket.end.bind(socket));\n    socket.on('error', (e) => {\n      debug('connection error', e);\n      canWrite = false;\n      emptyBuffer();\n    });\n    socket.on('close', createSocket);\n  }\n\n  createSocket();\n\n  function log(loggingEvent) {\n    if (canWrite) {\n      write(loggingEvent);\n    } else {\n      debug('buffering log event because it cannot write at the moment');\n      buffer.push(loggingEvent);\n    }\n  }\n\n  log.shutdown = function (cb) {\n    debug('shutdown called');\n    if (buffer.length && shutdownAttempts) {\n      debug('buffer has items, waiting 100ms to empty');\n      shutdownAttempts -= 1;\n      setTimeout(() => {\n        log.shutdown(cb);\n      }, 100);\n    } else {\n      socket.removeAllListeners('close');\n      socket.end(cb);\n    }\n  };\n  return log;\n}\n\nfunction configure(config, layouts) {\n  debug(`configure with config = ${config}`);\n  let layout = function (loggingEvent) {\n    return loggingEvent.serialise();\n  };\n  if (config.layout) {\n    layout = layouts.layout(config.layout.type, config.layout);\n  }\n  return appender(config, layout);\n}\n\nmodule.exports.configure = configure;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}