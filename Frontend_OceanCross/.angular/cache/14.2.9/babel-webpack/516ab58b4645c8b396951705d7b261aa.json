{"ast":null,"code":"const debug = require('debug')('log4js:file');\n\nconst path = require('path');\n\nconst streams = require('streamroller');\n\nconst os = require('os');\n\nconst eol = os.EOL;\nlet mainSighupListenerStarted = false;\nconst sighupListeners = new Set();\n\nfunction mainSighupHandler() {\n  sighupListeners.forEach(app => {\n    app.sighupHandler();\n  });\n}\n/**\n * File Appender writing the logs to a text file. Supports rolling of logs by size.\n *\n * @param file the file log messages will be written to\n * @param layout a function that takes a logEvent and returns a string\n *   (defaults to basicLayout).\n * @param logSize - the maximum size (in bytes) for a log file,\n *   if not provided then logs won't be rotated.\n * @param numBackups - the number of log files to keep after logSize\n *   has been reached (default 5)\n * @param options - options to be passed to the underlying stream\n * @param timezoneOffset - optional timezone offset in minutes (default system local)\n */\n\n\nfunction fileAppender(file, layout, logSize, numBackups, options, timezoneOffset) {\n  if (typeof file !== 'string' || file.length === 0) {\n    throw new Error(`Invalid filename: ${file}`);\n  } else if (file.endsWith(path.sep)) {\n    throw new Error(`Filename is a directory: ${file}`);\n  } else {\n    // handle ~ expansion: https://github.com/nodejs/node/issues/684\n    // exclude ~ and ~filename as these can be valid files\n    file = file.replace(new RegExp(`^~(?=${path.sep}.+)`), os.homedir());\n  }\n\n  file = path.normalize(file);\n  numBackups = !numBackups && numBackups !== 0 ? 5 : numBackups;\n  debug('Creating file appender (', file, ', ', logSize, ', ', numBackups, ', ', options, ', ', timezoneOffset, ')');\n\n  function openTheStream(filePath, fileSize, numFiles, opt) {\n    const stream = new streams.RollingFileStream(filePath, fileSize, numFiles, opt);\n    stream.on('error', err => {\n      // eslint-disable-next-line no-console\n      console.error('log4js.fileAppender - Writing to file %s, error happened ', filePath, err);\n    });\n    stream.on('drain', () => {\n      process.emit('log4js:pause', false);\n    });\n    return stream;\n  }\n\n  let writer = openTheStream(file, logSize, numBackups, options);\n\n  const app = function (loggingEvent) {\n    if (!writer.writable) {\n      return;\n    }\n\n    if (options.removeColor === true) {\n      // eslint-disable-next-line no-control-regex\n      const regex = /\\x1b[[0-9;]*m/g;\n      loggingEvent.data = loggingEvent.data.map(d => {\n        if (typeof d === 'string') return d.replace(regex, '');\n        return d;\n      });\n    }\n\n    if (!writer.write(layout(loggingEvent, timezoneOffset) + eol, 'utf8')) {\n      process.emit('log4js:pause', true);\n    }\n  };\n\n  app.reopen = function () {\n    writer.end(() => {\n      writer = openTheStream(file, logSize, numBackups, options);\n    });\n  };\n\n  app.sighupHandler = function () {\n    debug('SIGHUP handler called.');\n    app.reopen();\n  };\n\n  app.shutdown = function (complete) {\n    sighupListeners.delete(app);\n\n    if (sighupListeners.size === 0 && mainSighupListenerStarted) {\n      process.removeListener('SIGHUP', mainSighupHandler);\n      mainSighupListenerStarted = false;\n    }\n\n    writer.end('', 'utf-8', complete);\n  }; // On SIGHUP, close and reopen all files. This allows this appender to work with\n  // logrotate. Note that if you are using logrotate, you should not set\n  // `logSize`.\n\n\n  sighupListeners.add(app);\n\n  if (!mainSighupListenerStarted) {\n    process.on('SIGHUP', mainSighupHandler);\n    mainSighupListenerStarted = true;\n  }\n\n  return app;\n}\n\nfunction configure(config, layouts) {\n  let layout = layouts.basicLayout;\n\n  if (config.layout) {\n    layout = layouts.layout(config.layout.type, config.layout);\n  } // security default (instead of relying on streamroller default)\n\n\n  config.mode = config.mode || 0o600;\n  return fileAppender(config.filename, layout, config.maxLogSize, config.backups, config, config.timezoneOffset);\n}\n\nmodule.exports.configure = configure;","map":{"version":3,"names":["debug","require","path","streams","os","eol","EOL","mainSighupListenerStarted","sighupListeners","Set","mainSighupHandler","forEach","app","sighupHandler","fileAppender","file","layout","logSize","numBackups","options","timezoneOffset","length","Error","endsWith","sep","replace","RegExp","homedir","normalize","openTheStream","filePath","fileSize","numFiles","opt","stream","RollingFileStream","on","err","console","error","process","emit","writer","loggingEvent","writable","removeColor","regex","data","map","d","write","reopen","end","shutdown","complete","delete","size","removeListener","add","configure","config","layouts","basicLayout","type","mode","filename","maxLogSize","backups","module","exports"],"sources":["/Users/deliabarbuta/Documents/An4Sem1/PAW/Proiect/proiect-paw-tadam/Frontend_OceanCross/node_modules/log4js/lib/appenders/file.js"],"sourcesContent":["const debug = require('debug')('log4js:file');\nconst path = require('path');\nconst streams = require('streamroller');\nconst os = require('os');\n\nconst eol = os.EOL;\n\nlet mainSighupListenerStarted = false;\nconst sighupListeners = new Set();\nfunction mainSighupHandler() {\n  sighupListeners.forEach((app) => {\n    app.sighupHandler();\n  });\n}\n\n/**\n * File Appender writing the logs to a text file. Supports rolling of logs by size.\n *\n * @param file the file log messages will be written to\n * @param layout a function that takes a logEvent and returns a string\n *   (defaults to basicLayout).\n * @param logSize - the maximum size (in bytes) for a log file,\n *   if not provided then logs won't be rotated.\n * @param numBackups - the number of log files to keep after logSize\n *   has been reached (default 5)\n * @param options - options to be passed to the underlying stream\n * @param timezoneOffset - optional timezone offset in minutes (default system local)\n */\nfunction fileAppender(\n  file,\n  layout,\n  logSize,\n  numBackups,\n  options,\n  timezoneOffset\n) {\n  if (typeof file !== 'string' || file.length === 0) {\n    throw new Error(`Invalid filename: ${file}`);\n  } else if (file.endsWith(path.sep)) {\n    throw new Error(`Filename is a directory: ${file}`);\n  } else {\n    // handle ~ expansion: https://github.com/nodejs/node/issues/684\n    // exclude ~ and ~filename as these can be valid files\n    file = file.replace(new RegExp(`^~(?=${path.sep}.+)`), os.homedir());\n  }\n  file = path.normalize(file);\n  numBackups = !numBackups && numBackups !== 0 ? 5 : numBackups;\n\n  debug(\n    'Creating file appender (',\n    file,\n    ', ',\n    logSize,\n    ', ',\n    numBackups,\n    ', ',\n    options,\n    ', ',\n    timezoneOffset,\n    ')'\n  );\n\n  function openTheStream(filePath, fileSize, numFiles, opt) {\n    const stream = new streams.RollingFileStream(\n      filePath,\n      fileSize,\n      numFiles,\n      opt\n    );\n    stream.on('error', (err) => {\n      // eslint-disable-next-line no-console\n      console.error(\n        'log4js.fileAppender - Writing to file %s, error happened ',\n        filePath,\n        err\n      );\n    });\n    stream.on('drain', () => {\n      process.emit('log4js:pause', false);\n    });\n    return stream;\n  }\n\n  let writer = openTheStream(file, logSize, numBackups, options);\n\n  const app = function (loggingEvent) {\n    if (!writer.writable) {\n      return;\n    }\n    if (options.removeColor === true) {\n      // eslint-disable-next-line no-control-regex\n      const regex = /\\x1b[[0-9;]*m/g;\n      loggingEvent.data = loggingEvent.data.map((d) => {\n        if (typeof d === 'string') return d.replace(regex, '');\n        return d;\n      });\n    }\n    if (!writer.write(layout(loggingEvent, timezoneOffset) + eol, 'utf8')) {\n      process.emit('log4js:pause', true);\n    }\n  };\n\n  app.reopen = function () {\n    writer.end(() => {\n      writer = openTheStream(file, logSize, numBackups, options);\n    });\n  };\n\n  app.sighupHandler = function () {\n    debug('SIGHUP handler called.');\n    app.reopen();\n  };\n\n  app.shutdown = function (complete) {\n    sighupListeners.delete(app);\n    if (sighupListeners.size === 0 && mainSighupListenerStarted) {\n      process.removeListener('SIGHUP', mainSighupHandler);\n      mainSighupListenerStarted = false;\n    }\n    writer.end('', 'utf-8', complete);\n  };\n\n  // On SIGHUP, close and reopen all files. This allows this appender to work with\n  // logrotate. Note that if you are using logrotate, you should not set\n  // `logSize`.\n  sighupListeners.add(app);\n  if (!mainSighupListenerStarted) {\n    process.on('SIGHUP', mainSighupHandler);\n    mainSighupListenerStarted = true;\n  }\n\n  return app;\n}\n\nfunction configure(config, layouts) {\n  let layout = layouts.basicLayout;\n  if (config.layout) {\n    layout = layouts.layout(config.layout.type, config.layout);\n  }\n\n  // security default (instead of relying on streamroller default)\n  config.mode = config.mode || 0o600;\n\n  return fileAppender(\n    config.filename,\n    layout,\n    config.maxLogSize,\n    config.backups,\n    config,\n    config.timezoneOffset\n  );\n}\n\nmodule.exports.configure = configure;\n"],"mappings":"AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAAP,CAAiB,aAAjB,CAAd;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAD,CAApB;;AACA,MAAME,OAAO,GAAGF,OAAO,CAAC,cAAD,CAAvB;;AACA,MAAMG,EAAE,GAAGH,OAAO,CAAC,IAAD,CAAlB;;AAEA,MAAMI,GAAG,GAAGD,EAAE,CAACE,GAAf;AAEA,IAAIC,yBAAyB,GAAG,KAAhC;AACA,MAAMC,eAAe,GAAG,IAAIC,GAAJ,EAAxB;;AACA,SAASC,iBAAT,GAA6B;EAC3BF,eAAe,CAACG,OAAhB,CAAyBC,GAAD,IAAS;IAC/BA,GAAG,CAACC,aAAJ;EACD,CAFD;AAGD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASC,YAAT,CACEC,IADF,EAEEC,MAFF,EAGEC,OAHF,EAIEC,UAJF,EAKEC,OALF,EAMEC,cANF,EAOE;EACA,IAAI,OAAOL,IAAP,KAAgB,QAAhB,IAA4BA,IAAI,CAACM,MAAL,KAAgB,CAAhD,EAAmD;IACjD,MAAM,IAAIC,KAAJ,CAAW,qBAAoBP,IAAK,EAApC,CAAN;EACD,CAFD,MAEO,IAAIA,IAAI,CAACQ,QAAL,CAAcrB,IAAI,CAACsB,GAAnB,CAAJ,EAA6B;IAClC,MAAM,IAAIF,KAAJ,CAAW,4BAA2BP,IAAK,EAA3C,CAAN;EACD,CAFM,MAEA;IACL;IACA;IACAA,IAAI,GAAGA,IAAI,CAACU,OAAL,CAAa,IAAIC,MAAJ,CAAY,QAAOxB,IAAI,CAACsB,GAAI,KAA5B,CAAb,EAAgDpB,EAAE,CAACuB,OAAH,EAAhD,CAAP;EACD;;EACDZ,IAAI,GAAGb,IAAI,CAAC0B,SAAL,CAAeb,IAAf,CAAP;EACAG,UAAU,GAAG,CAACA,UAAD,IAAeA,UAAU,KAAK,CAA9B,GAAkC,CAAlC,GAAsCA,UAAnD;EAEAlB,KAAK,CACH,0BADG,EAEHe,IAFG,EAGH,IAHG,EAIHE,OAJG,EAKH,IALG,EAMHC,UANG,EAOH,IAPG,EAQHC,OARG,EASH,IATG,EAUHC,cAVG,EAWH,GAXG,CAAL;;EAcA,SAASS,aAAT,CAAuBC,QAAvB,EAAiCC,QAAjC,EAA2CC,QAA3C,EAAqDC,GAArD,EAA0D;IACxD,MAAMC,MAAM,GAAG,IAAI/B,OAAO,CAACgC,iBAAZ,CACbL,QADa,EAEbC,QAFa,EAGbC,QAHa,EAIbC,GAJa,CAAf;IAMAC,MAAM,CAACE,EAAP,CAAU,OAAV,EAAoBC,GAAD,IAAS;MAC1B;MACAC,OAAO,CAACC,KAAR,CACE,2DADF,EAEET,QAFF,EAGEO,GAHF;IAKD,CAPD;IAQAH,MAAM,CAACE,EAAP,CAAU,OAAV,EAAmB,MAAM;MACvBI,OAAO,CAACC,IAAR,CAAa,cAAb,EAA6B,KAA7B;IACD,CAFD;IAGA,OAAOP,MAAP;EACD;;EAED,IAAIQ,MAAM,GAAGb,aAAa,CAACd,IAAD,EAAOE,OAAP,EAAgBC,UAAhB,EAA4BC,OAA5B,CAA1B;;EAEA,MAAMP,GAAG,GAAG,UAAU+B,YAAV,EAAwB;IAClC,IAAI,CAACD,MAAM,CAACE,QAAZ,EAAsB;MACpB;IACD;;IACD,IAAIzB,OAAO,CAAC0B,WAAR,KAAwB,IAA5B,EAAkC;MAChC;MACA,MAAMC,KAAK,GAAG,gBAAd;MACAH,YAAY,CAACI,IAAb,GAAoBJ,YAAY,CAACI,IAAb,CAAkBC,GAAlB,CAAuBC,CAAD,IAAO;QAC/C,IAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B,OAAOA,CAAC,CAACxB,OAAF,CAAUqB,KAAV,EAAiB,EAAjB,CAAP;QAC3B,OAAOG,CAAP;MACD,CAHmB,CAApB;IAID;;IACD,IAAI,CAACP,MAAM,CAACQ,KAAP,CAAalC,MAAM,CAAC2B,YAAD,EAAevB,cAAf,CAAN,GAAuCf,GAApD,EAAyD,MAAzD,CAAL,EAAuE;MACrEmC,OAAO,CAACC,IAAR,CAAa,cAAb,EAA6B,IAA7B;IACD;EACF,CAfD;;EAiBA7B,GAAG,CAACuC,MAAJ,GAAa,YAAY;IACvBT,MAAM,CAACU,GAAP,CAAW,MAAM;MACfV,MAAM,GAAGb,aAAa,CAACd,IAAD,EAAOE,OAAP,EAAgBC,UAAhB,EAA4BC,OAA5B,CAAtB;IACD,CAFD;EAGD,CAJD;;EAMAP,GAAG,CAACC,aAAJ,GAAoB,YAAY;IAC9Bb,KAAK,CAAC,wBAAD,CAAL;IACAY,GAAG,CAACuC,MAAJ;EACD,CAHD;;EAKAvC,GAAG,CAACyC,QAAJ,GAAe,UAAUC,QAAV,EAAoB;IACjC9C,eAAe,CAAC+C,MAAhB,CAAuB3C,GAAvB;;IACA,IAAIJ,eAAe,CAACgD,IAAhB,KAAyB,CAAzB,IAA8BjD,yBAAlC,EAA6D;MAC3DiC,OAAO,CAACiB,cAAR,CAAuB,QAAvB,EAAiC/C,iBAAjC;MACAH,yBAAyB,GAAG,KAA5B;IACD;;IACDmC,MAAM,CAACU,GAAP,CAAW,EAAX,EAAe,OAAf,EAAwBE,QAAxB;EACD,CAPD,CA9EA,CAuFA;EACA;EACA;;;EACA9C,eAAe,CAACkD,GAAhB,CAAoB9C,GAApB;;EACA,IAAI,CAACL,yBAAL,EAAgC;IAC9BiC,OAAO,CAACJ,EAAR,CAAW,QAAX,EAAqB1B,iBAArB;IACAH,yBAAyB,GAAG,IAA5B;EACD;;EAED,OAAOK,GAAP;AACD;;AAED,SAAS+C,SAAT,CAAmBC,MAAnB,EAA2BC,OAA3B,EAAoC;EAClC,IAAI7C,MAAM,GAAG6C,OAAO,CAACC,WAArB;;EACA,IAAIF,MAAM,CAAC5C,MAAX,EAAmB;IACjBA,MAAM,GAAG6C,OAAO,CAAC7C,MAAR,CAAe4C,MAAM,CAAC5C,MAAP,CAAc+C,IAA7B,EAAmCH,MAAM,CAAC5C,MAA1C,CAAT;EACD,CAJiC,CAMlC;;;EACA4C,MAAM,CAACI,IAAP,GAAcJ,MAAM,CAACI,IAAP,IAAe,KAA7B;EAEA,OAAOlD,YAAY,CACjB8C,MAAM,CAACK,QADU,EAEjBjD,MAFiB,EAGjB4C,MAAM,CAACM,UAHU,EAIjBN,MAAM,CAACO,OAJU,EAKjBP,MALiB,EAMjBA,MAAM,CAACxC,cANU,CAAnB;AAQD;;AAEDgD,MAAM,CAACC,OAAP,CAAeV,SAAf,GAA2BA,SAA3B"},"metadata":{},"sourceType":"script"}