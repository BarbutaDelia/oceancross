{"ast":null,"code":"\"use strict\";\n\nconst fs = require(\"fs\");\n\nconst path = require(\"path\");\n/** @typedef {import(\"webpack\").Compiler} Compiler */\n\n/** @typedef {import(\"webpack\").MultiCompiler} MultiCompiler */\n\n/** @typedef {import(\"webpack\").Compilation} Compilation */\n\n/** @typedef {import(\"../index.js\").IncomingMessage} IncomingMessage */\n\n/** @typedef {import(\"../index.js\").ServerResponse} ServerResponse */\n\n/**\n * @template {IncomingMessage} Request\n * @template {ServerResponse} Response\n * @param {import(\"../index.js\").Context<Request, Response>} context\n */\n\n\nfunction setupWriteToDisk(context) {\n  /**\n   * @type {Compiler[]}\n   */\n  const compilers =\n  /** @type {MultiCompiler} */\n  context.compiler.compilers || [context.compiler];\n\n  for (const compiler of compilers) {\n    compiler.hooks.emit.tap(\"DevMiddleware\",\n    /**\n     * @param {Compilation} compilation\n     */\n    compilation => {\n      // @ts-ignore\n      if (compiler.hasWebpackDevMiddlewareAssetEmittedCallback) {\n        return;\n      }\n\n      compiler.hooks.assetEmitted.tapAsync(\"DevMiddleware\", (file, info, callback) => {\n        /**\n         * @type {string}\n         */\n        let targetPath;\n        /**\n         * @type {Buffer}\n         */\n\n        let content; // webpack@5\n\n        if (info.compilation) {\n          ({\n            targetPath,\n            content\n          } = info);\n        } else {\n          let targetFile = file;\n          const queryStringIdx = targetFile.indexOf(\"?\");\n\n          if (queryStringIdx >= 0) {\n            targetFile = targetFile.slice(0, queryStringIdx);\n          }\n\n          let {\n            outputPath\n          } = compiler;\n          outputPath = compilation.getPath(outputPath, {}); // @ts-ignore\n\n          content = info;\n          targetPath = path.join(outputPath, targetFile);\n        }\n\n        const {\n          writeToDisk: filter\n        } = context.options;\n        const allowWrite = filter && typeof filter === \"function\" ? filter(targetPath) : true;\n\n        if (!allowWrite) {\n          return callback();\n        }\n\n        const dir = path.dirname(targetPath);\n        const name = compiler.options.name ? `Child \"${compiler.options.name}\": ` : \"\";\n        return fs.mkdir(dir, {\n          recursive: true\n        }, mkdirError => {\n          if (mkdirError) {\n            context.logger.error(`${name}Unable to write \"${dir}\" directory to disk:\\n${mkdirError}`);\n            return callback(mkdirError);\n          }\n\n          return fs.writeFile(targetPath, content, writeFileError => {\n            if (writeFileError) {\n              context.logger.error(`${name}Unable to write \"${targetPath}\" asset to disk:\\n${writeFileError}`);\n              return callback(writeFileError);\n            }\n\n            context.logger.log(`${name}Asset written to disk: \"${targetPath}\"`);\n            return callback();\n          });\n        });\n      }); // @ts-ignore\n\n      compiler.hasWebpackDevMiddlewareAssetEmittedCallback = true;\n    });\n  }\n}\n\nmodule.exports = setupWriteToDisk;","map":{"version":3,"names":["fs","require","path","setupWriteToDisk","context","compilers","compiler","hooks","emit","tap","compilation","hasWebpackDevMiddlewareAssetEmittedCallback","assetEmitted","tapAsync","file","info","callback","targetPath","content","targetFile","queryStringIdx","indexOf","slice","outputPath","getPath","join","writeToDisk","filter","options","allowWrite","dir","dirname","name","mkdir","recursive","mkdirError","logger","error","writeFile","writeFileError","log","module","exports"],"sources":["/Users/deliabarbuta/Documents/An4Sem1/PAW/Proiect/proiect-paw-tadam/Frontend_OceanCross/node_modules/webpack-dev-middleware/dist/utils/setupWriteToDisk.js"],"sourcesContent":["\"use strict\";\n\nconst fs = require(\"fs\");\n\nconst path = require(\"path\");\n/** @typedef {import(\"webpack\").Compiler} Compiler */\n\n/** @typedef {import(\"webpack\").MultiCompiler} MultiCompiler */\n\n/** @typedef {import(\"webpack\").Compilation} Compilation */\n\n/** @typedef {import(\"../index.js\").IncomingMessage} IncomingMessage */\n\n/** @typedef {import(\"../index.js\").ServerResponse} ServerResponse */\n\n/**\n * @template {IncomingMessage} Request\n * @template {ServerResponse} Response\n * @param {import(\"../index.js\").Context<Request, Response>} context\n */\n\n\nfunction setupWriteToDisk(context) {\n  /**\n   * @type {Compiler[]}\n   */\n  const compilers =\n  /** @type {MultiCompiler} */\n  context.compiler.compilers || [context.compiler];\n\n  for (const compiler of compilers) {\n    compiler.hooks.emit.tap(\"DevMiddleware\",\n    /**\n     * @param {Compilation} compilation\n     */\n    compilation => {\n      // @ts-ignore\n      if (compiler.hasWebpackDevMiddlewareAssetEmittedCallback) {\n        return;\n      }\n\n      compiler.hooks.assetEmitted.tapAsync(\"DevMiddleware\", (file, info, callback) => {\n        /**\n         * @type {string}\n         */\n        let targetPath;\n        /**\n         * @type {Buffer}\n         */\n\n        let content; // webpack@5\n\n        if (info.compilation) {\n          ({\n            targetPath,\n            content\n          } = info);\n        } else {\n          let targetFile = file;\n          const queryStringIdx = targetFile.indexOf(\"?\");\n\n          if (queryStringIdx >= 0) {\n            targetFile = targetFile.slice(0, queryStringIdx);\n          }\n\n          let {\n            outputPath\n          } = compiler;\n          outputPath = compilation.getPath(outputPath, {}); // @ts-ignore\n\n          content = info;\n          targetPath = path.join(outputPath, targetFile);\n        }\n\n        const {\n          writeToDisk: filter\n        } = context.options;\n        const allowWrite = filter && typeof filter === \"function\" ? filter(targetPath) : true;\n\n        if (!allowWrite) {\n          return callback();\n        }\n\n        const dir = path.dirname(targetPath);\n        const name = compiler.options.name ? `Child \"${compiler.options.name}\": ` : \"\";\n        return fs.mkdir(dir, {\n          recursive: true\n        }, mkdirError => {\n          if (mkdirError) {\n            context.logger.error(`${name}Unable to write \"${dir}\" directory to disk:\\n${mkdirError}`);\n            return callback(mkdirError);\n          }\n\n          return fs.writeFile(targetPath, content, writeFileError => {\n            if (writeFileError) {\n              context.logger.error(`${name}Unable to write \"${targetPath}\" asset to disk:\\n${writeFileError}`);\n              return callback(writeFileError);\n            }\n\n            context.logger.log(`${name}Asset written to disk: \"${targetPath}\"`);\n            return callback();\n          });\n        });\n      }); // @ts-ignore\n\n      compiler.hasWebpackDevMiddlewareAssetEmittedCallback = true;\n    });\n  }\n}\n\nmodule.exports = setupWriteToDisk;"],"mappings":"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"},"metadata":{},"sourceType":"script"}